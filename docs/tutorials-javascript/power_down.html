<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" >

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Cousine|Inconsolata" rel="stylesheet">
	<link rel="shortcut icon" type="image/png" href="/favicon.png">

	
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/css/fontawesome-all.min.css">
	<script src="/js/main.js"></script>
	

	<!-- Begin Jekyll SEO tag v2.1.0 -->
<title>JS: Power Down - Steem Developer</title>
<meta property="og:title" content="JS: Power Down" />
<meta name="description" content="In this tutorial we will show how to perform a power down on all or part of an accounts VESTS using Steemconnect as well as show a clientside signing method" />
<meta property="og:description" content="In this tutorial we will show how to perform a power down on all or part of an accounts VESTS using Steemconnect as well as show a clientside signing method" />
<link rel="canonical" href="https://developer.steem.io/tutorials-javascript/power_down" />
<meta property="og:url" content="https://developer.steem.io/tutorials-javascript/power_down" />
<meta property="og:site_name" content="Steem Developer" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-07-18T16:19:24-05:00" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "JS: Power Down",
"datePublished": "2018-07-18T16:19:24-05:00",
"description": "In this tutorial we will show how to perform a power down on all or part of an accounts VESTS using Steemconnect as well as show a clientside signing method",
"url": "https://developer.steem.io/tutorials-javascript/power_down"}</script>
<!-- End Jekyll SEO tag -->


	
</head>
<body>
<header>
	<h1>
		<button type="button" class="open-nav" id="open-nav"></button>
		<a href="/"  class="logo-link"><img src="/images/logotype_white.svg" height="40" alt="Steem Developer logo"></a>
	</h1>

	
	<form action="/search/" method="get">
		<input type="text" name="q" id="search-input" placeholder="Search">
		<input type="submit" value="Search" style="display: none;">
	</form>
	

	<div id="sidebar" class="sidebar">
	
	
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/">
		<h6 class="ctrl-nav-section title">Introduction</h6>
		<ul class="cont-nav-section content">
			
				
					
					
						
						<li><a href="/#introduction-welcome">Welcome to Steem</a></li>
						
					
				
			
		</ul>
	</section>
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/quickstart/">
		<h6 class="ctrl-nav-section title">Quickstart</h6>
		<ul class="cont-nav-section content">
			
				
					
					
						
						<li><a href="/quickstart/#quickstart-choose-library">Choose Library</a></li>
						
					
						
						<li><a href="/quickstart/#quickstart-steemd-nodes">steemd Nodes</a></li>
						
					
						
						<li><a href="/quickstart/#quickstart-testnet">Steem Testnet</a></li>
						
					
				
			
		</ul>
	</section>
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/tutorials/">
		<h6 class="ctrl-nav-section title">Tutorials</h6>
		<ul class="cont-nav-section content">
			
				
					
						<li><a href="/tutorials/#tutorials-javascript">Javascript</a></li>
					
				
					
						<li><a href="/tutorials/#tutorials-python">Python</a></li>
					
				
					
						<li><a href="/tutorials/#tutorials-ruby">Ruby</a></li>
					
				
					
						<li><a href="/tutorials/#tutorials-recipes">Recipes</a></li>
					
				
			
		</ul>
	</section>
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/services/">
		<h6 class="ctrl-nav-section title">Services</h6>
		<ul class="cont-nav-section content">
			
				
					
					
						
						<li><a href="/services/#services-steemit">Steemit.com</a></li>
						
					
						
						<li><a href="/services/#services-sbds">SBDS</a></li>
						
					
						
						<li><a href="/services/#services-jussi">jussi</a></li>
						
					
						
						<li><a href="/services/#services-steemconnect">SteemConnect</a></li>
						
					
				
			
		</ul>
	</section>
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/apidefinitions/">
		<h6 class="ctrl-nav-section title">Appbase API</h6>
		<ul class="cont-nav-section content">
			
				
					
					
						
						<li><a href="/apidefinitions/#apidefinitions-condenser-api">Condenser Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-account-by-key-api">Account By Key Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-broadcast-ops-comment">Broadcast Ops Comment</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-account-history-api">Account History Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-database-api">Database Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-follow-api">Follow Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-jsonrpc">Jsonrpc</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-market-history-api">Market History Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-network-broadcast-api">Network Broadcast Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-tags-api">Tags Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-witness-api">Witness Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-block-api">Block Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-broadcast-ops">Broadcast Ops</a></li>
						
					
				
			
		</ul>
	</section>
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/community/">
		<h6 class="ctrl-nav-section title">Community</h6>
		<ul class="cont-nav-section content">
			
				
					
					
						
						<li><a href="/community/#community-overview">Overview</a></li>
						
					
						
						<li><a href="/community/#community-resources">Resources</a></li>
						
					
						
						<li><a href="/community/#community-developeradvocate">Sharing & Help</a></li>
						
					
				
			
		</ul>
	</section>
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/glossary/">
		<h6 class="ctrl-nav-section title">Glossary</h6>
		<ul class="cont-nav-section content">
			
				
					
					
						
						<li><a href="/glossary/#glossary-chain-basics">Chain Basics</a></li>
						
					
						
					
						
						<li><a href="/glossary/#glossary-governance">Governance</a></li>
						
					
						
						<li><a href="/glossary/#glossary-transactions">Transactions</a></li>
						
					
						
						<li><a href="/glossary/#glossary-api">API</a></li>
						
					
						
						<li><a href="/glossary/#glossary-market">Market</a></li>
						
					
				
			
		</ul>
	</section>
	
</div>


	<!--<p class="copyright">-->
	<!--<a href="https://steemit.com.com/">-->
	<!--steemit-->
	<!--</a>-->
	<!--</p>-->
	<link href="https://fonts.googleapis.com/css?family=Nunito" rel="stylesheet">
</header>
<div class="main" id="top">
	<div class="hero">
		<h1 class="hero__h1">Steem Developer Portal </h1>
		
		<img class="hero__img" src="/images/hero.png">
		
	</div>
	<section id="tutorials-javascript-power-down" class="row tutorials-javascript-power-down">
	<h3>
		<a id="tutorials-javascript-power-down">
			JS: Power Down
			
		</a>
	</h3>
	
		<p class="description">In this tutorial we will show how to perform a power down on all or part of an accounts VESTS using Steemconnect as well as show a clientside signing method</p>
	

	<p><span class="fa-pull-left top-of-tutorial-repo-link"><span class="first-word">Full</span>, runnable src of <a href="https://github.com/steemit/devportal-tutorials-js/tree/master/tutorials/23_power_down">Power Down</a> can be downloaded as part of the <a href="https://github.com/steemit/devportal-tutorials-js">JS tutorials repository</a>.</span>
<br /></p>

<p>This tutorial runs on the main Steem blockchain. Therefore, any accounts used here will affect real funds on the live network. <strong>Use with caution.</strong></p>

<h2 id="intro">Intro</h2>

<p>This tutorial will demonstrate a few functions such as querying account by name and determining the vesting balance of the related account. We are using the <code class="highlighter-rouge">call</code> function provided by the <code class="highlighter-rouge">dsteem</code> library to pull account data from the Steem blockchain. We then calculate STEEM Power from the VESTS (vesting shares) for the convenience of the user. We will use a simple HTML interface to capture the account and its VESTS. It also has an interactive UI to perform a power down in full or in part.</p>

<h2 id="steps">Steps</h2>

<ol>
  <li><a href="#app-setup"><strong>App setup</strong></a> Setup <code class="highlighter-rouge">dsteem</code> to use the proper connection and network.</li>
  <li><a href="#search-account"><strong>Search account</strong></a> Get account details after input has account name</li>
  <li><a href="#fill-form"><strong>Calculate and Fill form</strong></a> Calculate available vesting shares and fill the form with details</li>
  <li><a href="#power-down"><strong>Power down</strong></a> Power down VESTS with Steemconnect or client-side signing.</li>
</ol>

<h4 id="1-app-setup-">1. App setup <a name="app-setup"></a></h4>

<p>Below, we have <code class="highlighter-rouge">dsteem</code> pointing to the production network with the proper chainId, addressPrefix, and endpoint. There is a <code class="highlighter-rouge">public/app.js</code> file which holds the Javascript segment of this tutorial. In the first few lines we define the configured library and packages:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">dsteem</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'dsteem'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">opts</span> <span class="o">=</span> <span class="p">{};</span>
<span class="c1">//connect to production server</span>
<span class="nx">opts</span><span class="p">.</span><span class="nx">addressPrefix</span> <span class="o">=</span> <span class="s1">'STM'</span><span class="p">;</span>
<span class="nx">opts</span><span class="p">.</span><span class="nx">chainId</span> <span class="o">=</span>
    <span class="s1">'0000000000000000000000000000000000000000000000000000000000000000'</span><span class="p">;</span>
<span class="c1">//connect to server which is connected to the network/production</span>
<span class="kr">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">dsteem</span><span class="p">.</span><span class="nx">Client</span><span class="p">(</span><span class="s1">'https://api.steemit.com'</span><span class="p">);</span>
</code></pre>
</div>

<h4 id="2-search-account-">2. Search account <a name="search-account"></a></h4>

<p>After the account name field has been filled with a name, we automatically search for the account by name when the input is focused out. The related HTML input forms can be found in the <code class="highlighter-rouge">index.html</code> file. The values are pulled from that screen with the following:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code>    <span class="kr">const</span> <span class="nx">accSearch</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'username'</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">_account</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">database</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">'get_accounts'</span><span class="p">,</span> <span class="p">[[</span><span class="nx">accSearch</span><span class="p">]]);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">_account</span><span class="err">:`</span><span class="p">,</span> <span class="nx">_account</span><span class="p">);</span>
</code></pre>
</div>

<h4 id="3-calculate-and-fill-form-">3. Calculate and Fill form <a name="fill-form"></a></h4>

<p>Once the account data has been fetched, we will fill the form with VESTS balance and show current balance details. Note, that in order to get the available vesting shares we will have to check a few things:</p>

<ul>
  <li>if account is already powering down</li>
  <li>how much is currently powering down</li>
  <li>how much has been delegated (because active delegation locks those funds from being powered down)</li>
</ul>

<p>Available balance will be in the <code class="highlighter-rouge">avail</code> variable.</p>

<p>For the convenience of the user, we will convert available VESTS to STEEM with <code class="highlighter-rouge">getDynamicGlobalProperties</code> function and fill the form fields accordingly.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code>    <span class="kr">const</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">_account</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">name</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">avail</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">_account</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">vesting_shares</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">_account</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">to_withdraw</span><span class="p">)</span> <span class="o">-</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">_account</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">withdrawn</span><span class="p">))</span> <span class="o">/</span> <span class="mi">1</span><span class="nx">e6</span> <span class="o">-</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">_account</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">delegated_vesting_shares</span><span class="p">);</span>

    <span class="kr">const</span> <span class="nx">props</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">database</span><span class="p">.</span><span class="nx">getDynamicGlobalProperties</span><span class="p">();</span>
    <span class="kr">const</span> <span class="nx">vestSteem</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">total_vesting_fund_steem</span><span class="p">)</span> <span class="o">*</span>
        <span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">avail</span><span class="p">)</span> <span class="o">/</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">total_vesting_shares</span><span class="p">)),</span><span class="mi">6</span><span class="p">);</span>

    <span class="kr">const</span> <span class="nx">balance</span> <span class="o">=</span> <span class="err">`</span><span class="nx">Available</span> <span class="nx">Vests</span> <span class="k">for</span> <span class="nx">$</span><span class="p">{</span><span class="nx">name</span><span class="p">}</span><span class="err">:</span> <span class="nx">$</span><span class="p">{</span><span class="nx">avail</span><span class="p">}</span> <span class="nx">VESTS</span> <span class="o">~</span> <span class="nx">$</span><span class="p">{</span><span class="nx">vestSteem</span><span class="p">}</span> <span class="nx">STEEM</span> <span class="nx">POWER</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;&lt;</span><span class="nx">br</span><span class="o">/&gt;</span><span class="err">`</span><span class="p">;</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'accBalance'</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">balance</span><span class="p">;</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'steem'</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">avail</span><span class="o">+</span><span class="s1">' VESTS'</span><span class="p">;</span>
</code></pre>
</div>

<p>Once form is filled with the maximum available VESTS balance, we can choose the amount of VESTS to power down.</p>

<h4 id="4-power-down-">4. Power down <a name="power-down"></a></h4>

<p>We have two options on how to Power down: Steemconnect and client-side signing. By default we generate a Steemconnect link to Power down (withdraw vesting), but we can also choose the client signing option to Power down right inside tutorial. <strong>Note:</strong> client-side signing will require Active Private key to perform the operation.</p>

<p>In order to enable client signing, we will generate the operation and also show Active Private key (wif) field to sign transaction right there, client side.</p>

<p>Below, we can see an example of the operation and signing transaction. After a successful broadcast, the result will be shown in user interface. It will show the block number that the transaction was included in.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">submitTx</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">privateKey</span> <span class="o">=</span> <span class="nx">dsteem</span><span class="p">.</span><span class="nx">PrivateKey</span><span class="p">.</span><span class="nx">fromString</span><span class="p">(</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'wif'</span><span class="p">).</span><span class="nx">value</span>
    <span class="p">);</span>
    <span class="kr">const</span> <span class="nx">op</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">'withdraw_vesting'</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="na">account</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'username'</span><span class="p">).</span><span class="nx">value</span><span class="p">,</span>
            <span class="na">vesting_shares</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'steem'</span><span class="p">).</span><span class="nx">value</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">];</span>
    <span class="nx">client</span><span class="p">.</span><span class="nx">broadcast</span><span class="p">.</span><span class="nx">sendOperations</span><span class="p">([</span><span class="nx">op</span><span class="p">],</span> <span class="nx">privateKey</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'result'</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">'block'</span><span class="p">;</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span>
                <span class="s1">'result'</span>
            <span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="err">`</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Included</span> <span class="k">in</span> <span class="na">block</span><span class="p">:</span> <span class="nx">$</span><span class="p">{</span>
                <span class="nx">result</span><span class="p">.</span><span class="nx">block_num</span>
            <span class="p">}</span><span class="o">&lt;</span><span class="sr">/p&gt;&lt;br/</span><span class="o">&gt;&lt;</span><span class="nx">br</span><span class="o">/&gt;</span><span class="err">`</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">);</span>
<span class="p">};</span>
</code></pre>
</div>

<p>Thatâ€™s it!</p>

<h3 id="to-run-this-tutorial">To run this tutorial</h3>

<ol>
  <li><code class="highlighter-rouge">git clone https://github.com/steemit/devportal-tutorials-js.git</code></li>
  <li><code class="highlighter-rouge">cd devportal-tutorials-js/tutorials/23_power_down</code></li>
  <li><code class="highlighter-rouge">npm i</code></li>
  <li><code class="highlighter-rouge">npm run dev-server</code> or <code class="highlighter-rouge">npm run start</code></li>
  <li>After a few moments, the server should be running at <a href="http://localhost:3000/">http://localhost:3000/</a></li>
</ol>

<hr />

</section>

</div>
<div class="footer">
	<a href="#">Back to top</a>
</div>
<script>
    document.getElementById("open-nav").addEventListener("click", function () {
        document.body.classList.toggle("nav-open");
    });
</script>
</body>
</html>


<script src="/js/adjust.js"></script>

