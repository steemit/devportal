<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" >

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Cousine|Inconsolata" rel="stylesheet">
	<link rel="shortcut icon" type="image/png" href="/favicon.png">

	
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/css/fontawesome-all.min.css">
	<script src="/js/main.js"></script>
	

	<!-- Begin Jekyll SEO tag v2.1.0 -->
<title>PY: Power Down - Steem Developer</title>
<meta property="og:title" content="PY: Power Down" />
<meta name="description" content="How to power down (withdraw) your vesting shares using Python." />
<meta property="og:description" content="How to power down (withdraw) your vesting shares using Python." />
<link rel="canonical" href="https://developer.steem.io/tutorials-python/power_down" />
<meta property="og:url" content="https://developer.steem.io/tutorials-python/power_down" />
<meta property="og:site_name" content="Steem Developer" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-09-24T22:41:53-05:00" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "PY: Power Down",
"datePublished": "2018-09-24T22:41:53-05:00",
"description": "How to power down (withdraw) your vesting shares using Python.",
"url": "https://developer.steem.io/tutorials-python/power_down"}</script>
<!-- End Jekyll SEO tag -->


	
</head>
<body>
<header>
	<h1>
		<button type="button" class="open-nav" id="open-nav"></button>
		<a href="/"  class="logo-link"><img src="/images/logotype_white.svg" height="40" alt="Steem Developer logo"></a>
	</h1>

	
	<form action="/search/" method="get">
		<input type="text" name="q" id="search-input" placeholder="Search">
		<input type="submit" value="Search" style="display: none;">
	</form>
	

	<div id="sidebar" class="sidebar">
	
	
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/">
		<h6 class="ctrl-nav-section title">Introduction</h6>
		<ul class="cont-nav-section content">
			
				
					
					
						
						<li><a href="/#introduction-welcome">Welcome to Steem</a></li>
						
					
				
			
		</ul>
	</section>
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/quickstart/">
		<h6 class="ctrl-nav-section title">Quickstart</h6>
		<ul class="cont-nav-section content">
			
				
					
					
						
						<li><a href="/quickstart/#quickstart-choose-library">Choose Library</a></li>
						
					
						
						<li><a href="/quickstart/#quickstart-steemd-nodes">steemd Nodes</a></li>
						
					
						
						<li><a href="/quickstart/#quickstart-testnet">Steem Testnet</a></li>
						
					
				
			
		</ul>
	</section>
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/tutorials/">
		<h6 class="ctrl-nav-section title">Tutorials</h6>
		<ul class="cont-nav-section content">
			
				
					
						<li><a href="/tutorials/#tutorials-javascript">Javascript</a></li>
					
				
					
						<li><a href="/tutorials/#tutorials-python">Python</a></li>
					
				
					
						<li><a href="/tutorials/#tutorials-ruby">Ruby</a></li>
					
				
					
						<li><a href="/tutorials/#tutorials-recipes">Recipes</a></li>
					
				
			
		</ul>
	</section>
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/services/">
		<h6 class="ctrl-nav-section title">Services</h6>
		<ul class="cont-nav-section content">
			
				
					
					
						
						<li><a href="/services/#services-steemit">Steemit.com</a></li>
						
					
						
						<li><a href="/services/#services-steemconnect">SteemConnect</a></li>
						
					
						
						<li><a href="/services/#services-jussi">jussi</a></li>
						
					
						
						<li><a href="/services/#services-imagehoster">ImageHoster</a></li>
						
					
						
						<li><a href="/services/#services-sbds">SBDS</a></li>
						
					
				
			
		</ul>
	</section>
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/apidefinitions/">
		<h6 class="ctrl-nav-section title">Appbase API</h6>
		<ul class="cont-nav-section content">
			
				
					
					
						
						<li><a href="/apidefinitions/#apidefinitions-condenser-api">Condenser Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-account-by-key-api">Account By Key Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-broadcast-ops-comment">Broadcast Ops Comment</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-account-history-api">Account History Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-database-api">Database Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-follow-api">Follow Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-jsonrpc">Jsonrpc</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-market-history-api">Market History Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-network-broadcast-api">Network Broadcast Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-rc-api">Rc Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-tags-api">Tags Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-witness-api">Witness Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-block-api">Block Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-broadcast-ops">Broadcast Ops</a></li>
						
					
				
			
		</ul>
	</section>
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/community/">
		<h6 class="ctrl-nav-section title">Community</h6>
		<ul class="cont-nav-section content">
			
				
					
					
						
						<li><a href="/community/#community-overview">Overview</a></li>
						
					
						
						<li><a href="/community/#community-resources">Resources</a></li>
						
					
						
						<li><a href="/community/#community-developeradvocate">Sharing & Help</a></li>
						
					
				
			
		</ul>
	</section>
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/glossary/">
		<h6 class="ctrl-nav-section title">Glossary</h6>
		<ul class="cont-nav-section content">
			
				
					
					
						
						<li><a href="/glossary/#glossary-chain-basics">Chain Basics</a></li>
						
					
						
					
						
						<li><a href="/glossary/#glossary-governance">Governance</a></li>
						
					
						
						<li><a href="/glossary/#glossary-transactions">Transactions</a></li>
						
					
						
						<li><a href="/glossary/#glossary-api">API</a></li>
						
					
						
						<li><a href="/glossary/#glossary-market">Market</a></li>
						
					
				
			
		</ul>
	</section>
	
</div>


	<!--<p class="copyright">-->
	<!--<a href="https://steemit.com.com/">-->
	<!--steemit-->
	<!--</a>-->
	<!--</p>-->
	<link href="https://fonts.googleapis.com/css?family=Nunito" rel="stylesheet">
</header>
<div class="main" id="top">
	<div class="hero">
		<h1 class="hero__h1">Steem Developer Portal </h1>
		
		<img class="hero__img" src="/images/hero.png">
		
	</div>
	<section id="tutorials-python-power-down" class="row tutorials-python-power-down">
	<h3>
		<a id="tutorials-python-power-down">
			PY: Power Down
			
		</a>
	</h3>
	
		<span class="description"><p>How to power down (withdraw) your vesting shares using Python.</p>
</span>
	

	<p><span class="fa-pull-left top-of-tutorial-repo-link"><span class="first-word">Full</span>, runnable src of <a href="https://github.com/steemit/devportal-tutorials-py/tree/master/tutorials/25_power_down">Power Down</a> can be downloaded as part of the <a href="https://github.com/steemit/devportal-tutorials-py">PY tutorials repository</a>.</span>
<br /></p>

<p>In this tutorial we will explain and show you how to power down some or all of your available vesting shares (STEEM POWER) on the <strong>Steem</strong> blockchain using the <code class="highlighter-rouge">commit</code> class found within the <a href="https://github.com/steemit/steem-python">steem-python</a> library.</p>

<h2 id="intro">Intro</h2>

<p>The Steem python library has a built-in function to transmit transactions to the blockchain. We are using the <code class="highlighter-rouge">withdraw_vesting</code> method found within the <code class="highlighter-rouge">commit</code> class in the library. When you power down, the converted VESTS (STEEM POWER) will not be available as STEEM immediately. It is converted in 13 equal parts and transferred into your STEEM wallet weekly, the first portion only being available a week after the power down was initiated. Before we do the conversion, we check the current balance of the account to check how much STEEM POWER is available. This is not strictly necessary as the process will automatically abort with the corresponding error, but it does give some insight into the process as a whole. We use the <code class="highlighter-rouge">get_account</code> function to check for this. The <code class="highlighter-rouge">withdraw_vesting</code> method has 2 parameters:</p>

<ol>
  <li><em>amount</em> - The amount of VESTS that will be withdrawn. This must be of the <code class="highlighter-rouge">float</code> data type</li>
  <li><em>account</em> - The specified user account for the transfer</li>
</ol>

<h2 id="steps">Steps</h2>

<ol>
  <li><a href="#setup"><strong>App setup</strong></a> - Library install and import. Connection to testnet</li>
  <li><a href="#userinfo"><strong>User information and steem node</strong></a> - Input user information and connection to Steem node</li>
  <li><a href="#balance"><strong>Check balance</strong></a> - Check current vesting balance of user account</li>
  <li><a href="#convert"><strong>Conversion amount and commit</strong></a> - Input of VESTS amount to convert and commit to blockchain</li>
</ol>

<h4 id="1-app-setup-">1. App setup <a name="setup"></a></h4>

<p>In this tutorial we use 2 packages:</p>

<ul>
  <li><code class="highlighter-rouge">steem</code> - steem-python library and interaction with Blockchain</li>
  <li><code class="highlighter-rouge">pick</code> - helps select the query type interactively</li>
</ul>

<p>We import the libraries and connect to the <code class="highlighter-rouge">testnet</code>.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">steembase</span>
<span class="kn">import</span> <span class="nn">steem</span>
<span class="kn">from</span> <span class="nn">pick</span> <span class="kn">import</span> <span class="n">pick</span>
<span class="kn">from</span> <span class="nn">steem.amount</span> <span class="kn">import</span> <span class="n">Amount</span>

<span class="n">steembase</span><span class="o">.</span><span class="n">chains</span><span class="o">.</span><span class="n">known_chains</span><span class="p">[</span><span class="s">'STEEM'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'chain_id'</span><span class="p">:</span> <span class="s">'79276aea5d4877d9a25892eaa01b0adf019d3e5cb12a97478df3298ccdd01673'</span><span class="p">,</span>
    <span class="s">'prefix'</span><span class="p">:</span> <span class="s">'STX'</span><span class="p">,</span> <span class="s">'steem_symbol'</span><span class="p">:</span> <span class="s">'STEEM'</span><span class="p">,</span> <span class="s">'sbd_symbol'</span><span class="p">:</span> <span class="s">'SBD'</span><span class="p">,</span> <span class="s">'vests_symbol'</span><span class="p">:</span> <span class="s">'VESTS'</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Because this tutorial alters the blockchain we connect to the testnet so we don’t create spam on the production server.</p>

<h4 id="2-user-information-and-steem-node-">2. User information and steem node <a name="userinfo"></a></h4>

<p>We require the <code class="highlighter-rouge">private active key</code> of the user in order for the conversion to be committed to the blockchain. This is why we have to specify this alongside the <code class="highlighter-rouge">testnet</code> node. The values are supplied via the terminal/console before we initialise the steem class. There is a demo account available to use with this tutorial but any account that is set up on the testnet can be used.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#capture user information</span>
<span class="n">username</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'Enter username: '</span><span class="p">)</span> <span class="c">#demo account: cdemo</span>
<span class="n">wif</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'Enter private ACTIVE key: '</span><span class="p">)</span> <span class="c">#demo account: 5KaNM84WWSqzwKzY82fXPaUW43idbLnPqf5SfjGxLfw6eV2kAP3</span>

<span class="c">#connect node and private active key</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">steem</span><span class="o">.</span><span class="n">Steem</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="p">[</span><span class="s">'https://testnet.steem.vc'</span><span class="p">],</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="n">wif</span><span class="p">])</span>
</code></pre>
</div>

<h4 id="3-check-balance-">3. Check balance <a name="balance"></a></h4>

<p>In order to give the user enough information to make the conversion we check the current balance of the account using the <code class="highlighter-rouge">get_account</code> function.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#get account balance for vesting shares</span>
<span class="n">userinfo</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_account</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
<span class="n">delegated_vests</span> <span class="o">=</span> <span class="n">userinfo</span><span class="p">[</span><span class="s">'delegated_vesting_shares'</span><span class="p">]</span>
<span class="n">vesting_shares</span> <span class="o">=</span> <span class="n">userinfo</span><span class="p">[</span><span class="s">'vesting_shares'</span><span class="p">]</span>
<span class="n">to_withdraw</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">userinfo</span><span class="p">[</span><span class="s">'to_withdraw'</span><span class="p">])</span>
<span class="n">withdrawn</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">userinfo</span><span class="p">[</span><span class="s">'withdrawn'</span><span class="p">])</span>

<span class="n">available_vests</span> <span class="o">=</span> <span class="p">(</span><span class="n">Amount</span><span class="p">(</span><span class="n">vesting_shares</span><span class="p">)</span><span class="o">.</span><span class="n">amount</span> <span class="o">-</span> <span class="n">Amount</span><span class="p">(</span><span class="n">delegated_vests</span><span class="p">)</span><span class="o">.</span><span class="n">amount</span> <span class="o">-</span> 
     <span class="p">((</span><span class="n">to_withdraw</span> <span class="o">-</span> <span class="n">withdrawn</span><span class="p">)</span><span class="o">/</span><span class="mi">1000000</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="s">'VESTS currently powering down: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">to_withdraw</span><span class="o">/</span><span class="mi">1000000</span><span class="p">)</span> <span class="o">+</span> <span class="s">' VESTS'</span> <span class="o">+</span>
    <span class="s">'</span><span class="se">\n</span><span class="s">'</span> <span class="o">+</span> <span class="s">'Available VESTS: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">available_vests</span><span class="p">)</span> <span class="o">+</span> <span class="s">' VESTS'</span><span class="p">)</span>

<span class="nb">input</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span> <span class="o">+</span> <span class="s">'Press enter to continue'</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
</code></pre>
</div>

<p>The available vesting shares to withdraw is not directly available from the user information and needs to be calculated. In order to find the total VESTS available to power down we need to know how much is currently in power down, how much has been delegated and then the total amount of vesting shares. The values are assigned from the query directly as <code class="highlighter-rouge">float</code> type to make the calculations a little simpler. The results of the query and calculation are converted to <code class="highlighter-rouge">string</code> type and displayed in the console/terminal.</p>

<h4 id="4-conversion-amount-and-commit-">4. Conversion amount and commit <a name="convert"></a></h4>

<p>The user is given the option to withdraw all available vesting shares, a portion of the shares or to cancel the transaction completely.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#choice of transfer</span>
<span class="n">title</span> <span class="o">=</span> <span class="s">'Please choose an option: '</span>
<span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Power down ALL'</span><span class="p">,</span> <span class="s">'Power down PORTION'</span><span class="p">,</span> <span class="s">'Cancel Transaction'</span><span class="p">]</span>
<span class="n">option</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">pick</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
</code></pre>
</div>

<p>Based on the input from the user the <code class="highlighter-rouge">amount</code> variable can be assigned and the transaction committed to the blockchain. The amount must be between zero and the total amount of vesting shares (both pending conversion and available VESTS combined). <strong>The amount you set to be withdrawn will override the current amount of vesting shares pending withdrawal.</strong> If for example the user enters a new amount of ‘0’ shares to be withdrawn, it will cancel the current withdrawal completely.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#parameters: amount, account</span>
<span class="k">if</span> <span class="p">(</span><span class="n">option</span> <span class="o">==</span> <span class="s">'Cancel Transaction'</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'transaction cancelled'</span><span class="p">)</span>
    <span class="nb">exit</span><span class="p">()</span>
<span class="k">else</span> <span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">option</span> <span class="o">==</span> <span class="s">'Power down ALL'</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">available_vests</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'No change to withdraw amount'</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">amount</span> <span class="o">=</span> <span class="n">to_withdraw</span><span class="o">/</span><span class="mi">1000000</span> <span class="o">+</span> <span class="n">available_vests</span>
            <span class="n">client</span><span class="o">.</span><span class="n">withdraw_vesting</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span> <span class="o">+</span> <span class="s">' VESTS now powering down'</span><span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">'Please enter the amount of VESTS you would like to power down: '</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">amount</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">to_withdraw</span><span class="o">/</span><span class="mi">1000000</span> <span class="o">+</span> <span class="n">available_vests</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">client</span><span class="o">.</span><span class="n">withdraw_vesting</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span> <span class="o">+</span> <span class="s">' VESTS now powering down'</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">amount</span> <span class="o">==</span> <span class="n">to_withdraw</span><span class="o">/</span><span class="mi">1000000</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">'No change to withdraw amount'</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">'insufficient funds available'</span><span class="p">)</span>
</code></pre>
</div>

<p>The result is displayed on the console/terminal.</p>

<p>We encourage users to play around with different values and data types to fully understand how this process works. You can also check the balances and transaction history on the <a href="http://condenser.steem.vc/">testnet portal</a>.</p>

<h3 id="to-run-the-tutorial">To Run the tutorial</h3>

<ol>
  <li><a href="getting_started">review dev requirements</a></li>
  <li>clone this repo</li>
  <li><code class="highlighter-rouge">cd tutorials/25_power_down</code></li>
  <li><code class="highlighter-rouge">pip install -r requirements.txt</code></li>
  <li><code class="highlighter-rouge">python index.py</code></li>
  <li>After a few moments, you should see a prompt for input in terminal screen.</li>
</ol>

<hr />

</section>

</div>
<div class="footer">
	<a href="#">Back to top</a>
</div>
<script>
    document.getElementById("open-nav").addEventListener("click", function () {
        document.body.classList.toggle("nav-open");
    });
</script>
</body>
</html>


<script src="/js/adjust.js"></script>

