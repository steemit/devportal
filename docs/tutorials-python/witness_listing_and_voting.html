<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" >

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Cousine|Inconsolata" rel="stylesheet">
	<link rel="shortcut icon" type="image/png" href="/favicon.png">

	
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/css/fontawesome-all.min.css">
	<script src="/js/main.js"></script>
	

	<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>PY: Witness Listing And Voting | Steem Developer</title>
<meta name="generator" content="Jekyll v3.8.4" />
<meta property="og:title" content="PY: Witness Listing And Voting" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="How to vote for or remove a vote for a witness user using Python." />
<meta property="og:description" content="How to vote for or remove a vote for a witness user using Python." />
<link rel="canonical" href="https://developers.steem.io/tutorials-python/witness_listing_and_voting" />
<meta property="og:url" content="https://developers.steem.io/tutorials-python/witness_listing_and_voting" />
<meta property="og:site_name" content="Steem Developer" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-10-18T14:29:07-05:00" />
<script type="application/ld+json">
{"description":"How to vote for or remove a vote for a witness user using Python.","@type":"BlogPosting","url":"https://developers.steem.io/tutorials-python/witness_listing_and_voting","headline":"PY: Witness Listing And Voting","dateModified":"2018-10-18T14:29:07-05:00","datePublished":"2018-10-18T14:29:07-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://developers.steem.io/tutorials-python/witness_listing_and_voting"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


	
</head>
<body>
<header>
	<h1>
		<button type="button" class="open-nav" id="open-nav"></button>
		<a href="/"  class="logo-link"><img src="/images/logotype_white.svg" height="40" alt="Steem Developer logo"></a>
	</h1>

	
	<form action="/search/" method="get">
		<input type="text" name="q" id="search-input" placeholder="Search">
		<input type="submit" value="Search" style="display: none;">
	</form>
	

	<div id="sidebar" class="sidebar">
	
	
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/">
		<h6 class="ctrl-nav-section title">Introduction</h6>
		<ul class="cont-nav-section content">
			
				
					
					
						
						<li><a href="/#introduction-welcome">Welcome to Steem</a></li>
						
					
				
			
		</ul>
	</section>
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/quickstart/">
		<h6 class="ctrl-nav-section title">Quickstart</h6>
		<ul class="cont-nav-section content">
			
				
					
					
						
						<li><a href="/quickstart/#quickstart-choose-library">Choose Library</a></li>
						
					
						
						<li><a href="/quickstart/#quickstart-steemd-nodes">steemd Nodes</a></li>
						
					
						
						<li><a href="/quickstart/#quickstart-testnet">Steem Testnet</a></li>
						
					
				
			
		</ul>
	</section>
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/tutorials/">
		<h6 class="ctrl-nav-section title">Tutorials</h6>
		<ul class="cont-nav-section content">
			
				
					
						<li><a href="/tutorials/#tutorials-javascript">Javascript</a></li>
					
				
					
						<li><a href="/tutorials/#tutorials-python">Python</a></li>
					
				
					
						<li><a href="/tutorials/#tutorials-ruby">Ruby</a></li>
					
				
					
						<li><a href="/tutorials/#tutorials-recipes">Recipes</a></li>
					
				
			
		</ul>
	</section>
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/services/">
		<h6 class="ctrl-nav-section title">Services</h6>
		<ul class="cont-nav-section content">
			
				
					
					
						
						<li><a href="/services/#services-steemit">Steemit.com</a></li>
						
					
						
						<li><a href="/services/#services-steemconnect">SteemConnect</a></li>
						
					
						
						<li><a href="/services/#services-jussi">jussi</a></li>
						
					
						
						<li><a href="/services/#services-imagehoster">ImageHoster</a></li>
						
					
						
						<li><a href="/services/#services-sbds">SBDS</a></li>
						
					
				
			
		</ul>
	</section>
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/apidefinitions/">
		<h6 class="ctrl-nav-section title">Appbase API</h6>
		<ul class="cont-nav-section content">
			
				
					
					
						
						<li><a href="/apidefinitions/#apidefinitions-condenser-api">Condenser Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-broadcast-ops-comment">Broadcast Ops Comment</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-account-by-key-api">Account By Key Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-account-history-api">Account History Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-database-api">Database Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-follow-api">Follow Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-jsonrpc">Jsonrpc</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-market-history-api">Market History Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-network-broadcast-api">Network Broadcast Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-rc-api">Rc Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-tags-api">Tags Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-witness-api">Witness Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-block-api">Block Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-debug-node-api">Debug Node Api</a></li>
						
					
						
						<li><a href="/apidefinitions/#apidefinitions-broadcast-ops">Broadcast Ops</a></li>
						
					
				
			
		</ul>
	</section>
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/community/">
		<h6 class="ctrl-nav-section title">Community</h6>
		<ul class="cont-nav-section content">
			
				
					
					
						
						<li><a href="/community/#community-overview">Overview</a></li>
						
					
						
						<li><a href="/community/#community-resources">Resources</a></li>
						
					
						
						<li><a href="/community/#community-developeradvocate">Sharing & Help</a></li>
						
					
				
			
		</ul>
	</section>
	
		
    <section class="pnl-main-nav-section main-nav-section" url="/glossary/">
		<h6 class="ctrl-nav-section title">Glossary</h6>
		<ul class="cont-nav-section content">
			
				
					
					
						
						<li><a href="/glossary/#glossary-chain-basics">Chain Basics</a></li>
						
					
						
					
						
						<li><a href="/glossary/#glossary-governance">Governance</a></li>
						
					
						
						<li><a href="/glossary/#glossary-transactions">Transactions</a></li>
						
					
						
						<li><a href="/glossary/#glossary-api">API</a></li>
						
					
						
						<li><a href="/glossary/#glossary-market">Market</a></li>
						
					
				
			
		</ul>
	</section>
	
</div>


	<!--<p class="copyright">-->
	<!--<a href="https://steemit.com.com/">-->
	<!--steemit-->
	<!--</a>-->
	<!--</p>-->
	<link href="https://fonts.googleapis.com/css?family=Nunito" rel="stylesheet">
</header>
<div class="main" id="top">
	<div class="hero">
		<h1 class="hero__h1">Steem Developer Portal </h1>
		
		<img class="hero__img" src="/images/hero.png">
		
	</div>
	<section id="tutorials-python-witness-listing-and-voting" class="row tutorials-python-witness-listing-and-voting">
	<h3>
		<a id="tutorials-python-witness-listing-and-voting">
			PY: Witness Listing And Voting
			
		</a>
	</h3>
	
		<span class="description"><p>How to vote for or remove a vote for a witness user using Python.</p>
</span>
	

	<p><span class="fa-pull-left top-of-tutorial-repo-link"><span class="first-word">Full</span>, runnable src of <a href="https://github.com/steemit/devportal-tutorials-py/tree/master/tutorials/22_witness_listing_and_voting">Witness Listing And Voting</a> can be downloaded as part of the <a href="https://github.com/steemit/devportal-tutorials-py">PY tutorials repository</a>.</span>
<br /></p>

<p>In this tutorial we show you how to create a list of active witnesses from the <strong>Steem</strong> blockchain and then vote or unvote for a witness using the <code class="highlighter-rouge">commit</code> class found within the <a href="https://github.com/steemit/steem-python">steem-python</a> library.</p>

<h2 id="intro">Intro</h2>

<p>The Steem python library has a built-in function to transmit transactions to the blockchain. We are using the <code class="highlighter-rouge">approve_witness</code> and <code class="highlighter-rouge">disapprove_witness</code> method found within the <code class="highlighter-rouge">commit</code> class in the library. We also use the <code class="highlighter-rouge">get_active_witnesses</code> function to query the blockchain for a list of available witnesses. Before we vote, we use the <code class="highlighter-rouge">get_account</code> function to check for all the witnesses that the user has currently voted for. This is not strictly necessary but adds to the useability of the process. The <code class="highlighter-rouge">approve_witness</code> method has 3 parameters:</p>

<ol>
  <li><em>witness</em> - The witness to approve</li>
  <li><em>account</em> - The source user account for the voting</li>
  <li><em>approve</em> - This value is set to <code class="highlighter-rouge">True</code> when approving a witness</li>
</ol>

<p>The <code class="highlighter-rouge">disapprove_witness</code> has the same parameters except for <code class="highlighter-rouge">_approve_</code> which is not required.</p>

<h2 id="steps">Steps</h2>

<ol>
  <li><a href="#setup"><strong>App setup</strong></a> - Library install and import. Connection to testnet</li>
  <li><a href="#userinfo"><strong>User information and steem node</strong></a> - Input user information and connection to Steem node</li>
  <li><a href="#list"><strong>Active witness list</strong></a> - Create a list of active as well as already voted for witnesses</li>
  <li><a href="#commit"><strong>Vote / Unvote</strong></a> - Input witness name and commite vote/unvote to blockchain</li>
</ol>

<h4 id="1-app-setup-">1. App setup <a name="setup"></a></h4>

<p>In this tutorial we use 3 packages:</p>

<ul>
  <li><code class="highlighter-rouge">steem</code> - steem-python library and interaction with Blockchain</li>
  <li><code class="highlighter-rouge">pick</code> - helps select the query type interactively</li>
  <li><code class="highlighter-rouge">pprint</code> - print results in better format</li>
</ul>

<p>We import the libraries and connect to the <code class="highlighter-rouge">testnet</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">steembase</span>
<span class="kn">import</span> <span class="nn">steem</span>
<span class="kn">from</span> <span class="nn">pick</span> <span class="kn">import</span> <span class="n">pick</span>
<span class="kn">import</span> <span class="nn">pprint</span>

<span class="n">steembase</span><span class="o">.</span><span class="n">chains</span><span class="o">.</span><span class="n">known_chains</span><span class="p">[</span><span class="s">'STEEM'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'chain_id'</span><span class="p">:</span> <span class="s">'79276aea5d4877d9a25892eaa01b0adf019d3e5cb12a97478df3298ccdd01673'</span><span class="p">,</span>
    <span class="s">'prefix'</span><span class="p">:</span> <span class="s">'STX'</span><span class="p">,</span> <span class="s">'steem_symbol'</span><span class="p">:</span> <span class="s">'STEEM'</span><span class="p">,</span> <span class="s">'sbd_symbol'</span><span class="p">:</span> <span class="s">'SBD'</span><span class="p">,</span> <span class="s">'vests_symbol'</span><span class="p">:</span> <span class="s">'VESTS'</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Because this tutorial alters the blockchain we connect to a testnet so we don’t create spam on the production server.</p>

<h4 id="2-user-information-and-steem-node-">2. User information and steem node <a name="userinfo"></a></h4>

<p>We require the <code class="highlighter-rouge">private active key</code> of the user in order for the transaction to be committed to the blockchain. This is why we are using a testnet. The values are supplied via the terminal/console before we initialise the steem class. We also check if the user name provided is active on the chain. There are some demo accounts available but we encourage you to create your own accounts on this testnet.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#capture user information
</span><span class="n">username</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'Enter username: '</span><span class="p">)</span> <span class="c1">#demo account: cdemo
</span><span class="n">wif</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'Enter private ACTIVE key: '</span><span class="p">)</span> <span class="c1">#demo account: 5KaNM84WWSqzwKzY82fXPaUW43idbLnPqf5SfjGxLfw6eV2kAP3
</span>
<span class="c1">#connect node and private active key
</span><span class="n">client</span> <span class="o">=</span> <span class="n">steem</span><span class="o">.</span><span class="n">Steem</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="p">[</span><span class="s">'https://testnet.steem.vc'</span><span class="p">],</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="n">wif</span><span class="p">])</span>

<span class="c1">#check valid user
</span><span class="n">userinfo</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_account</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
<span class="k">if</span><span class="p">(</span><span class="n">userinfo</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Oops. Looks like user '</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">' doesn</span><span class="se">\'</span><span class="s">t exist on this chain!'</span><span class="p">)</span>
    <span class="nb">exit</span><span class="p">()</span>
</code></pre></div></div>

<h4 id="3-active-witness-list-">3. Active witness list <a name="list"></a></h4>

<p>We create a list of active witnesses so the user knows which witnesses are available to vote for. We do this by sending a query to the blockchain using the <code class="highlighter-rouge">get_active_witnesses</code> function. The result of this query is displayed on the UI.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#print list of active witnesses
</span><span class="k">print</span><span class="p">(</span><span class="s">'ACTIVE WITNESSES'</span><span class="p">)</span>
<span class="n">witness_list</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_active_witnesses</span><span class="p">()</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">witness_list</span><span class="p">)</span>
</code></pre></div></div>

<p>We also provide the user with a list of witnesses that has already been voted for by their account. From this the user will know which witnesses can be removed, and which can be added to their set of approved witnesses. We generate this list using the <code class="highlighter-rouge">get_account</code> function and display it on the UI.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#print list of currently voted for witnesses
</span><span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span> <span class="o">+</span> <span class="s">'WITNESSES CURRENTLY VOTED FOR'</span><span class="p">)</span>
<span class="n">vote_list</span> <span class="o">=</span> <span class="n">userinfo</span><span class="p">[</span><span class="s">'witness_votes'</span><span class="p">]</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">vote_list</span><span class="p">)</span>

<span class="nb">input</span><span class="p">(</span><span class="s">'Press enter to continue'</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="4-vote--unvote-">4. Vote / Unvote <a name="commit"></a></h4>

<p>The user is given the option to <code class="highlighter-rouge">VOTE</code>, <code class="highlighter-rouge">UNVOTE</code> or <code class="highlighter-rouge">CANCEL</code> the process. Depending on the choice the relevant function is executed. Both the <code class="highlighter-rouge">VOTE</code> and <code class="highlighter-rouge">UNVOTE</code> methods use the same input - the witness being added or removed. The different method executions are shown below.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#choice of action
</span><span class="n">title</span> <span class="o">=</span> <span class="p">(</span><span class="s">'Please choose action'</span><span class="p">)</span>
<span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s">'VOTE'</span><span class="p">,</span> <span class="s">'UNVOTE'</span><span class="p">,</span> <span class="s">'CANCEL'</span><span class="p">]</span>
<span class="n">option</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">pick</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>

<span class="k">if</span> <span class="p">(</span><span class="n">option</span> <span class="o">==</span> <span class="s">'CANCEL'</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span> <span class="o">+</span> <span class="s">'operation cancelled'</span><span class="p">)</span>
    <span class="nb">exit</span><span class="p">()</span>
</code></pre></div></div>

<p>VOTE :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="n">option</span> <span class="o">==</span> <span class="s">'VOTE'</span><span class="p">)</span> <span class="p">:</span>
    <span class="c1"># vote process
</span>    <span class="n">witness_vote</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'Please enter the witness name you wish to vote for: '</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">witness_vote</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">witness_list</span> <span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span> <span class="o">+</span> <span class="n">witness_vote</span> <span class="o">+</span> <span class="s">' does not appear on the available witness list'</span><span class="p">)</span>
        <span class="nb">exit</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">witness_vote</span> <span class="ow">in</span> <span class="n">vote_list</span> <span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span> <span class="o">+</span> <span class="n">witness_vote</span> <span class="o">+</span> <span class="s">' cannot be voted for more than once'</span><span class="p">)</span>
        <span class="nb">exit</span><span class="p">()</span>
    <span class="n">client</span><span class="o">.</span><span class="n">approve_witness</span><span class="p">(</span><span class="n">witness</span><span class="o">=</span><span class="n">witness_vote</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">approve</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span> <span class="o">+</span> <span class="n">witness_vote</span> <span class="o">+</span> <span class="s">' has been successfully voted for'</span><span class="p">)</span>
</code></pre></div></div>

<p>UNVOTE :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">else</span> <span class="p">:</span>
    <span class="c1"># unvote process
</span>    <span class="n">witness_unvote</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'Please enter the witness name you wish to remove the vote from: '</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">witness_unvote</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vote_list</span> <span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span> <span class="o">+</span> <span class="n">witness_unvote</span> <span class="o">+</span> <span class="s">' is not in your voted for list'</span><span class="p">)</span>
        <span class="nb">exit</span><span class="p">()</span>
    <span class="n">client</span><span class="o">.</span><span class="n">disapprove_witness</span><span class="p">(</span><span class="n">witness</span><span class="o">=</span><span class="n">witness_unvote</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">username</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span> <span class="o">+</span> <span class="n">witness_unvote</span> <span class="o">+</span> <span class="s">' has been removed from your voted for list'</span><span class="p">)</span>
</code></pre></div></div>

<p>A confirmation of the transaction to the blockchain is displayed on the UI.</p>

<p>We encourage users to play around with different values and data types to fully understand how this process works. You can also check the balances and transaction history on the <a href="http://condenser.steem.vc/">testnet portal</a>.</p>

<h3 id="to-run-the-tutorial">To Run the tutorial</h3>

<ol>
  <li><a href="getting_started">review dev requirements</a></li>
  <li>clone this repo</li>
  <li><code class="highlighter-rouge">cd tutorials/22_witness_listing_and_voting</code></li>
  <li><code class="highlighter-rouge">pip install -r requirements.txt</code></li>
  <li><code class="highlighter-rouge">python index.py</code></li>
  <li>After a few moments, you should see a prompt for input in terminal screen.</li>
</ol>

<hr />

</section>

</div>
<div class="footer">
	<a href="#">Back to top</a>
</div>
<script>
    document.getElementById("open-nav").addEventListener("click", function () {
        document.body.classList.toggle("nav-open");
    });
</script>
</body>
</html>


<script src="/js/adjust.js"></script>

